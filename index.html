<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>檔案切片與 AI 圖片辨識工具</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <link rel="apple-touch-icon" href="assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" href="assets/favicon/favicon.png">
    
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="libs/jszip.min.js"></script>
    <script src="libs/pdf.min.js"></script>
    <script src="libs/mammoth.browser.min.js"></script>
    <script src="libs/xlsx.full.min.js"></script>
</head>

<body class="bg-slate-50 min-h-screen p-4 md:p-8 text-slate-800">

    <div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
        <header class="bg-blue-600 p-6 text-white text-center">
            <h1 class="text-2xl font-bold">檔案切片與 AI 工具</h1>
            <p class="text-blue-100 text-sm mt-1">上傳文件，自動切分並打包為 Zip</p>
            <div class="mt-4 flex flex-wrap justify-center gap-2">
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">PDF</span>
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">DOCX/DOC/ODT</span>
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">XLSX/XLS/CSV</span>
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">PPTX/PPT</span>
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">TXT/MD</span>
                <span class="bg-blue-500/50 px-2 py-1 rounded text-[10px] border border-blue-400">IMG</span>
            </div>
        </header>

        <div class="p-6 space-y-8">
            <!-- 參數設定區 -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label class="block text-sm font-semibold mb-2">每片長度 (Character Length)</label>
                    <input type="number" id="chunkSize" value="1000"
                        class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">重疊長度 (Overflow/Overlap)</label>
                    <input type="number" id="overlapSize" value="100"
                        class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div class="flex items-center space-x-2 pt-8">
                    <input type="checkbox" id="smartSplit" checked class="w-5 h-5 text-blue-600 rounded">
                    <label for="smartSplit" class="text-sm font-semibold">智慧切分 (優先標點/換行)</label>
                </div>
            </section>

            <!-- AI 設定區 -->
            <section class="border-t pt-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-bold flex items-center">
                        <span class="mr-2">✨</span> AI 圖片轉文字 (選填)
                    </h2>
                    <button id="toggleAi" class="text-blue-600 text-sm hover:underline">展開設定</button>
                </div>

                <div id="aiSettings" class="hidden space-y-4 bg-slate-50 p-4 rounded-xl">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-semibold mb-1 uppercase tracking-wider text-slate-500">Base
                                URL</label>
                            <input type="text" id="aiBaseUrl" value="https://generativelanguage.googleapis.com"
                                class="w-full p-2 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold mb-1 uppercase tracking-wider text-slate-500">API
                                Key</label>
                            <input type="password" id="aiApiKey" placeholder="在此輸入 API Key"
                                class="w-full p-2 border rounded-lg text-sm">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-xs font-semibold mb-1 uppercase tracking-wider text-slate-500">Model</label>
                            <input type="text" id="aiModel" value="gemini-1.5-flash-latest"
                                class="w-full p-2 border rounded-lg text-sm">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold mb-1 uppercase tracking-wider text-slate-500">提示詞
                                (Prompt)</label>
                            <input type="text" id="aiPrompt" value="請辨識這張圖片中的所有文字，並將其轉換為純文字格式。"
                                class="w-full p-2 border rounded-lg text-sm">
                        </div>
                    </div>
                </div>
            </section>

            <!-- 檔案上傳區 -->
            <section>
                <div id="dropZone" class="drop-zone rounded-2xl p-12 text-center cursor-pointer">
                    <div class="flex flex-col items-center">
                        <svg class="w-12 h-12 text-slate-400 mb-4" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                        <p class="text-lg font-medium">點擊或拖拽檔案至此</p>
                        <p class="text-sm text-slate-500 mt-2">支援：PDF, Word, Excel, PPT, CSV, TXT, MD, 圖片</p>
                    </div>
                    <input type="file" id="fileInput" multiple class="hidden"
                        accept=".pdf,.docx,.doc,.odt,.xlsx,.xls,.ods,.pptx,.ppt,.odp,.csv,.txt,.md,.markdown,image/*">
                </div>

                <div class="flex justify-end mt-4">
                    <button id="clearAllBtn"
                        class="hidden text-red-500 hover:text-red-700 text-sm font-semibold flex items-center space-x-1 px-3 py-1 rounded hover:bg-red-50 transition">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                            </path>
                        </svg>
                        <span>移除全部檔案</span>
                    </button>
                </div>

                <div id="fileList" class="mt-2 space-y-2"></div>
            </section>

            <!-- 執行按鈕 (動態顯示) -->
            <div id="actionArea" class="hidden flex flex-col items-center space-y-4 pt-4 border-t mt-4">
                <div class="flex flex-wrap justify-center gap-4">
                    <button id="processBtn"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transition-transform active:scale-95 disabled:opacity-50 disabled:pointer-events-none flex items-center space-x-2">
                        <span>開始執行並下載 Zip</span>
                    </button>
                    <button id="downloadAgainBtn"
                        class="hidden bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-10 rounded-full shadow-lg transition-transform active:scale-95 flex items-center space-x-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        <span>再次下載 Zip</span>
                    </button>
                </div>
                <div id="status"
                    class="hidden text-center p-4 bg-blue-50 text-blue-700 rounded-lg animate-pulse w-full">
                    處理中，請稍候...
                </div>
            </div>

            <!-- 結果預覽區 -->
            <section id="resultsSection" class="hidden space-y-6 pt-6 border-t mt-6">
                <h2 class="text-xl font-bold text-slate-700 text-center">執行結果預覽 (前 3 個分片)</h2>
                <div id="resultsContainer" class="space-y-6"></div>
            </section>
        </div>
    </div>

    <script src="js/ui.js"></script>
    <script src="js/extractor.js"></script>
    <script src="js/chunker.js"></script>
    <script src="js/app.js"></script>
    <script src="js/sw-register.js"></script>
</body>

</html>
